<?php
namespace app\api\controller;
header('Content-Type: application/json;charset=utf-8');
header('Access-Control-Allow-Origin:*'); // *代表允许任何网址请求
header('Access-Control-Allow-Methods:POST,GET,OPTIONS,DELETE'); // 允许请求的类型
header('Access-Control-Allow-Credentials: true'); // 设置是否允许发送 cookies
header('Access-Control-Allow-Headers: Content-Type,Content-Length,Accept-Encoding,X-Requested-with, Origin'); // 设置允许自定义请求头的字段
use app\api\Model\Goods as goodsModel;
use think\Controller;
use think\Db;
class Index extends Base
{
    public $goods ;
    public function initialize()
    {
        parent::initialize(); // TODO: Change the autogenerated stub
        $this->goods = new goodsModel();
    }


    public function index(){
        return $this->fetch();
    }

    /**
     * goodsid , userid
     * return 单个商品信息
     */
    public function goods_find()
    {
        if (is_array($rqu = $this->text('post',['goodsid','userid'],1)) ||empty($rqu)){
            $goodsArr = $this->goods->findOne($rqu['goodsid']);
            return ret($goodsArr);
        }else{
            return $rqu;
        }


    }
    public function goods_add(){
       if (is_array($rqu = $this->text('get')) ||empty($rqu)){
           return $this->goods->add(['id'=>'1','name'=>'1234567890123456789012345']);
//           return ret('1');
       }else{
           return $rqu;
       }
    }

    /**
     * 验证是否登录，参数
     * type : post get
     * user:1为校验参数中用户ID是否登录
    */
    public function text($type,$arr=[],$user = ''){
        if ($type == 'post'){
            $req=$this->requset_post($arr);
        }else{
            $req=$this->requset_get($arr);
        }
        if ($req) {
            if (!empty($user) && $user == 1) {
                if (!empty($req['userid'])) {
                    $userid = $req['userid'];
                } else {
                    return ret('登录异常', 1002);
                }
                if (!$this->check_login($userid)) {
                    return ret('登录异常', 1002);
                }
                return $req;
            }
        } else{
            return ret('请求异常',1001);
        }
    }

}
